{% load static %}


<header class="pc-header">
    <div class="header-wrapper"> <!-- [Mobile Media Block] start -->
      <div class="me-auto pc-mob-drp">
        <ul class="list-unstyled">
          <!-- ======= Menu collapse Icon ===== -->
          <li class="pc-h-item pc-sidebar-collapse">
            <a href="#" class="pc-head-link ms-0" id="sidebar-hide">
              <i data-feather="menu"></i>
            </a>
          </li>
          <li class="pc-h-item pc-sidebar-popup">
            <a href="#" class="pc-head-link ms-0" id="mobile-collapse">
              <i data-feather="menu"></i>
            </a>
          </li>
          <li class="dropdown pc-h-item">
            <a
              class="pc-head-link dropdown-toggle arrow-none m-0 trig-drp-search"
              data-bs-toggle="dropdown"
              href="#"
              role="button"
              aria-haspopup="false"
              aria-expanded="false"
            >
              <i data-feather="search"></i>
            </a>
            <div class="dropdown-menu pc-h-dropdown drp-search">
              <form class="px-3 py-2">
                <input type="search" class="form-control border-0 shadow-none" placeholder="Search here. . ." />
              </form>
            </div>
          </li>
        </ul>
      </div>
      {% if messages %}
  <div class="container mt-3">
    {% for message in messages %}
      <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
      </div>
    {% endfor %}
  </div>
{% endif %}
      <!-- [Mobile Media Block end] -->
      <div class="ms-auto">
        <ul class="list-unstyled">
          <li class="dropdown pc-h-item">
            <a
              class="pc-head-link dropdown-toggle arrow-none me-0"
              data-bs-toggle="dropdown"
              href="#"
              role="button"
              aria-haspopup="false"
              aria-expanded="false"
            >
              <i data-feather="bell"></i>
              <span class="badge bg-success pc-h-badge">{{ notificaciones_no_leidas_count }}</span>
            </a>
<div class="dropdown-menu dropdown-notification dropdown-menu-end pc-h-dropdown">
  <div class="dropdown-header d-flex align-items-center justify-content-between">
    <h5 class="m-0">
      Notifications
      {% if notificaciones_no_leidas_count > 0 %}
        <span class="badge bg-danger">{{ notificaciones_no_leidas_count }}</span>
      {% endif %}
    </h5>
    <a href="{% url 'marcar_todas_como_leidas' %}" class="btn btn-link btn-sm">Mark all read</a>
  </div>

<div class="dropdown-body text-wrap header-notification-scroll position-relative" style="max-height: calc(100vh - 215px); overflow-y: auto; padding: 0 1rem;">
  <ul class="list-unstyled mb-0">
    {% for notificacion in notificaciones %}
      <li class="mb-2">
        <div class="p-3 rounded shadow-sm 
          {% if notificacion.leida %}
            bg-light text-secondary
          {% else %}
            bg-primary text-white fw-bold
          {% endif %}
        ">
          <small class="d-block mb-1">{{ notificacion.fecha|date:"d-m-Y H:i" }}</small>
          <span>{{ notificacion.mensaje }}</span>
        </div>
      </li>
    {% empty %}
      <li class="text-center py-3 text-muted fst-italic">No hay notificaciones.</li>
    {% endfor %}
  </ul>
</div>

<div class="text-center py-2 border-top">
  <a href="{% url 'eliminar_todas_las_notificaciones' %}" class="text-danger fw-semibold text-decoration-none">
    Clear all Notifications
  </a>
</div>




          </li>
          <li class="dropdown pc-h-item header-user-profile">
            <a
              class="pc-head-link dropdown-toggle arrow-none me-0"
              data-bs-toggle="dropdown"
              href="#"
              role="button"
              aria-haspopup="false"
              data-bs-auto-close="outside"
              aria-expanded="false"
            >
              <i data-feather="user"></i>
            </a>
            <div class="dropdown-menu dropdown-user-profile dropdown-menu-end pc-h-dropdown p-0 overflow-hidden">
              <div class="dropdown-header d-flex align-items-center justify-content-between bg-primary">
                <div class="d-flex my-2">
                  <div class="flex-shrink-0">
                    <img src="{% static "assets/images/user/avatar-2.jpg" %}" alt="user-image" class="user-avtar wid-35" />
                  </div>
                  <div class="flex-grow-1 ms-3">
                    <h6 class="text-white mb-1">
                      {{ request.user.username }}
                    </h6>
                    <span class="text-white text-opacity-75">{{ request.user.email }}</span>
                  </div>
                </div>
              </div>
              <div class="dropdown-body">
                <div class="profile-notification-scroll position-relative" style="max-height: calc(100vh - 225px)">
                  <a href="{% url "editar_configuracion" %}" class="dropdown-item">
                    <span>
                      <svg class="pc-icon text-muted me-2">
                        <use xlink:href="#custom-setting-outline"></use>
                      </svg>
                      <span>Settings</span>
                    </span>
                  </a>
                  <div class="d-grid my-2">
                    {% if request.user.is_authenticated %}
                    <a href="{% url "logout" %}" class="btn btn-primary">
                      <svg class="pc-icon me-2">
                        <use xlink:href="#custom-logout-1-outline"></use></svg
                      >Logout
                    </a>
                    {% else %}
                    <a href="{% url "login" %}" class="btn btn-primary">
                      <svg class="pc-icon me-2">
                        <use xlink:href="#custom-logout-1-outline"></use>
                      </svg>Login
                    </a>
                    {% endif %}
                  </div>
                </div>
              </div>
            </div>
          </li>
        </ul>
      </div>
    </div>
    
</header>

